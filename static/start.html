<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Car Safety Features Explorer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
        color: #333;
    }
    header {
        background-color: #004080;
        color: white;
        padding: 1rem;
        text-align: center;
    }
    main {
        padding: 2rem;
        max-width: 900px;
        margin: auto;
    }
    h2 {
        color: #004080;
    }
    section {
        margin-bottom: 2rem;
        background-color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    ul {
        list-style: none;
        padding-left: 0;
    }
    ul li {
        padding: 0.2rem 0;
    }
    a {
        color: #0066cc;
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
</style>
</head>
<body>
<header>
    <h1>Car Safety Features Explorer</h1>
</header>
<main>
    <section id="work-info">
        <h2>Loading work details...</h2>
    </section>
</main>

<script>
async function fetchWork(id) {
    const res = await fetch(`/openalex/id/${id}`);
    const work = await res.json();

    const container = document.getElementById('work-info');
    container.innerHTML = '';

    // Title and link
    const titleEl = document.createElement('h2');
    const linkEl = document.createElement('a');
    linkEl.href = work.primary_location?.landing_page_url || '#';
    linkEl.target = '_blank';
    linkEl.textContent = work.display_name || work.title;
    titleEl.appendChild(linkEl);
    container.appendChild(titleEl);

    // Publication info
    const pubSection = document.createElement('section');
    pubSection.innerHTML = `<strong>Publication Year:</strong> ${work.publication_year || 'N/A'}<br>
                            <strong>Type:</strong> ${work.type || 'N/A'}<br>
                            <strong>Language:</strong> ${work.language || 'N/A'}<br>
                            <strong>Cited by count:</strong> ${work.cited_by_count || 0}`;
    container.appendChild(pubSection);

    // Authors
    if (work.authorships && work.authorships.length > 0) {
        const authorSection = document.createElement('section');
        const authorList = document.createElement('ul');
        work.authorships.forEach(auth => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${auth.author.display_name}</strong>`;
            if (auth.author.orcid) {
                li.innerHTML += ` (<a href="${auth.author.orcid}" target="_blank">ORCID</a>)`;
            }
            authorList.appendChild(li);
        });
        authorSection.innerHTML = `<h3>Authors:</h3>`;
        authorSection.appendChild(authorList);
        container.appendChild(authorSection);
    }

    // Topics
    if (work.topics && work.topics.length > 0) {
        const topicSection = document.createElement('section');
        const topicList = document.createElement('ul');
        work.topics.forEach(topic => {
            const li = document.createElement('li');
            li.textContent = topic.display_name;
            topicList.appendChild(li);
        });
        topicSection.innerHTML = `<h3>Topics:</h3>`;
        topicSection.appendChild(topicList);
        container.appendChild(topicSection);
    }

    // Concepts
    if (work.concepts && work.concepts.length > 0) {
        const conceptSection = document.createElement('section');
        const conceptList = document.createElement('ul');
        work.concepts.forEach(concept => {
            const li = document.createElement('li');
            li.innerHTML = `${concept.display_name} 
                            ${concept.wikidata ? `(<a href="${concept.wikidata}" target="_blank">Wiki</a>)` : ''}`;
            conceptList.appendChild(li);
        });
        conceptSection.innerHTML = `<h3>Concepts:</h3>`;
        conceptSection.appendChild(conceptList);
        container.appendChild(conceptSection);
    }

    // Related works (link to same page with query param)
    if (work.related_works && work.related_works.length > 0) {
        const relatedSection = document.createElement('section');
        const relatedList = document.createElement('ul');
        work.related_works.forEach(rw => {
            const workId = rw.split('/').pop(); // Get the work ID
            const li = document.createElement('li');
            li.innerHTML = `<a href="data_explore.html?id=${workId}" target="_self">${workId}</a>`;
            relatedList.appendChild(li);
        });
        relatedSection.innerHTML = `<h3>Related Works:</h3>`;
        relatedSection.appendChild(relatedList);
        container.appendChild(relatedSection);
    }

    // Abstract
    if (work.abstract_inverted_index) {
        const abstractSection = document.createElement('section');
        let abstractText = '';
        Object.keys(work.abstract_inverted_index).forEach(word => {
            abstractText += word + ' ';
        });
        abstractSection.innerHTML = `<h3>Abstract:</h3><p>${abstractText.trim()}</p>`;
        container.appendChild(abstractSection);
    }
}

// Get work ID from query parameter or default
const urlParams = new URLSearchParams(window.location.search);
const workId = urlParams.get('id') || 'W3047121098';
fetchWork(workId);
</script>
</body>
</html>
